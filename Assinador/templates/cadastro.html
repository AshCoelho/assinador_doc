<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Usu√°rios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cadastro.css') }}">

</head>
<body class="bg-light">
    <div class="container my-5">
        <a href="{{ url_for('auth.login') }}" class="btn btn-secondary mb-4">‚Üê Voltar para o Login</a>

        <div class="card shadow mb-5">
            <div class="card-body">
                <h2 class="card-title mb-4">üìù Cadastro de Usu√°rio</h2>
                <form method="POST" action="{{ url_for('cadastro') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="editar_cpf" value="{{ usuario_editar['cpf'] if usuario_editar else '' }}">
                    
                    <div class="mb-3">
                        <label class="form-label">Nome:</label>
                        <input type="text" class="form-control" name="nome" value="{{ usuario_editar['nome'] if usuario_editar else '' }}" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">E-mail:</label>
                        <input type="email" class="form-control" name="email" value="{{ usuario_editar['email'] if usuario_editar else '' }}" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">CPF (somente n√∫meros):</label>
                        <input type="text" class="form-control" name="cpf" pattern="\d{11}" value="{{ usuario_editar['cpf'] if usuario_editar else '' }}" required>
                    </div>

                    <button type="submit" class="btn btn-primary">{{ 'Atualizar' if usuario_editar else 'Cadastrar' }}</button>
                    {% if usuario_editar %}
                    <a href="{{ url_for('cadastro') }}" class="btn btn-outline-secondary ms-2">Cancelar</a>
                    {% endif %}
                </form>
            </div>
        </div>

        <div class="card shadow">
            <div class="card-body">
                <h2 class="card-title mb-4">üë• Usu√°rios Cadastrados</h2>
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                            <th>Nome</th>
                            <th>E-mail</th>
                            <th>CPF</th>
                            <th>Criado em</th>
                            <th>Atualizado em</th>
                            <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for usuario in usuarios %}
                            <tr>
                            <td>{{ usuario.nome }}</td>
                            <td>{{ usuario.email }}</td>
                            <td>{{ usuario.cpf_masked }}</td>
                            <td>{{ usuario.created_at|fmt_dt }}</td>
                            <td>{{ usuario.updated_at|fmt_dt }}</td>
                            <td>
                                <a href="{{ url_for('editar', email=usuario.email) }}" class="btn btn-sm btn-warning">Editar</a>
                                <a href="{{ url_for('excluir', email=usuario.email) }}" class="btn btn-sm btn-danger" onclick="return confirm('Confirmar exclus√£o?')">Excluir</a>
                            </td>
                            </tr>
                            {% endfor %}
                            {% if not usuarios %}
                            <tr><td colspan="5" class="text-center text-muted">Nenhum usu√°rio cadastrado.</td></tr>
                            {% endif %}
                        </tbody>
                        </table>

                </div>
            </div>
        </div>
    </div>
</body>
</html>
